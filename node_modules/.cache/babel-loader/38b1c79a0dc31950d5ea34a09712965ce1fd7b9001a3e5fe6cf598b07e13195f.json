{"ast":null,"code":"var _jsxFileName = \"/Users/macbookair/Desktop/AeroJobs/AeroJob/frontend/src/contexts/AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// src/contexts/AuthContext.js\nimport React, { createContext, useContext, useEffect, useReducer } from 'react';\nimport { authAPI, setAuthToken } from '../utils/api';\nimport toast from 'react-hot-toast';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nconst ACTIONS = {\n  SET_LOADING: 'SET_LOADING',\n  LOGIN_SUCCESS: 'LOGIN_SUCCESS',\n  LOGOUT: 'LOGOUT',\n  UPDATE_USER: 'UPDATE_USER',\n  SET_ERROR: 'SET_ERROR'\n};\nconst initial = {\n  user: null,\n  token: null,\n  isAuthenticated: false,\n  loading: true,\n  error: null\n};\nfunction reducer(state, action) {\n  switch (action.type) {\n    case ACTIONS.SET_LOADING:\n      return {\n        ...state,\n        loading: action.payload\n      };\n    case ACTIONS.LOGIN_SUCCESS:\n      return {\n        ...state,\n        user: action.payload.user,\n        token: action.payload.token,\n        isAuthenticated: true,\n        loading: false,\n        error: null\n      };\n    case ACTIONS.UPDATE_USER:\n      return {\n        ...state,\n        user: action.payload\n      };\n    case ACTIONS.LOGOUT:\n      return {\n        ...initial,\n        loading: false\n      };\n    case ACTIONS.SET_ERROR:\n      return {\n        ...state,\n        error: action.payload,\n        loading: false\n      };\n    default:\n      return state;\n  }\n}\nfunction normalizeError(err, fallback = 'Something went wrong') {\n  if (err !== null && err !== void 0 && err.message) return err.message;\n  return fallback;\n}\n\n// role helpers (work with role | userType | type)\nconst getRoleFromUser = u => (u === null || u === void 0 ? void 0 : u.role) || (u === null || u === void 0 ? void 0 : u.userType) || (u === null || u === void 0 ? void 0 : u.type) || null;\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [state, dispatch] = useReducer(reducer, initial);\n\n  // Rehydrate token on refresh and fetch /auth/me\n  useEffect(() => {\n    const t = localStorage.getItem('token');\n    if (t) {\n      setAuthToken(t);\n      authAPI.me().then(me => dispatch({\n        type: ACTIONS.LOGIN_SUCCESS,\n        payload: {\n          user: me,\n          token: t\n        }\n      })).catch(() => {\n        localStorage.removeItem('token');\n        setAuthToken(null);\n        dispatch({\n          type: ACTIONS.SET_LOADING,\n          payload: false\n        });\n      });\n    } else {\n      dispatch({\n        type: ACTIONS.SET_LOADING,\n        payload: false\n      });\n    }\n  }, []);\n  async function login({\n    email,\n    password\n  }) {\n    dispatch({\n      type: ACTIONS.SET_LOADING,\n      payload: true\n    });\n    try {\n      const {\n        user,\n        token\n      } = await authAPI.login({\n        email,\n        password\n      });\n      localStorage.setItem('token', token);\n      setAuthToken(token);\n      dispatch({\n        type: ACTIONS.LOGIN_SUCCESS,\n        payload: {\n          user,\n          token\n        }\n      });\n      toast.success('Logged in!');\n      return {\n        success: true,\n        user\n      };\n    } catch (err) {\n      const msg = normalizeError(err, 'Login failed');\n      dispatch({\n        type: ACTIONS.SET_ERROR,\n        payload: msg\n      });\n      toast.error(msg);\n      return {\n        success: false,\n        error: msg\n      };\n    }\n  }\n  function logout(showToast = true) {\n    localStorage.removeItem('token');\n    setAuthToken(null);\n    dispatch({\n      type: ACTIONS.LOGOUT\n    });\n    if (showToast) toast('Logged out');\n  }\n  async function refreshMe() {\n    try {\n      const me = await authAPI.me();\n      dispatch({\n        type: ACTIONS.UPDATE_USER,\n        payload: me\n      });\n      return me;\n    } catch {\n      return null;\n    }\n  }\n\n  // NEW: safe updater so header re-renders after profile save/photo change\n  function updateUser(patchOrFn) {\n    const next = typeof patchOrFn === 'function' ? patchOrFn(state.user) : {\n      ...(state.user || {}),\n      ...(patchOrFn || {})\n    };\n    dispatch({\n      type: ACTIONS.UPDATE_USER,\n      payload: next\n    });\n    return next;\n  }\n\n  // role helpers for UI\n  const role = getRoleFromUser(state.user);\n  const hasRole = (...roles) => roles.includes(role);\n  const isAdmin = () => role === 'admin';\n  const isStudentOrAlumni = () => role === 'student' || role === 'alumni';\n  const value = {\n    ...state,\n    login,\n    logout,\n    refreshMe,\n    updateUser,\n    // expose\n    role,\n    hasRole,\n    isAdmin,\n    isStudentOrAlumni\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 141,\n    columnNumber: 10\n  }, this);\n}\n_s(AuthProvider, \"q+MzXaS5K5D+09en5v35HqexUBA=\");\n_c = AuthProvider;\nexport function useAuth() {\n  _s2();\n  const ctx = useContext(AuthContext);\n  if (!ctx) throw new Error('useAuth must be used within an AuthProvider');\n  return ctx;\n}\n_s2(useAuth, \"/dMy7t63NXD4eYACoT93CePwGrg=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useReducer","authAPI","setAuthToken","toast","jsxDEV","_jsxDEV","AuthContext","ACTIONS","SET_LOADING","LOGIN_SUCCESS","LOGOUT","UPDATE_USER","SET_ERROR","initial","user","token","isAuthenticated","loading","error","reducer","state","action","type","payload","normalizeError","err","fallback","message","getRoleFromUser","u","role","userType","AuthProvider","children","_s","dispatch","t","localStorage","getItem","me","then","catch","removeItem","login","email","password","setItem","success","msg","logout","showToast","refreshMe","updateUser","patchOrFn","next","hasRole","roles","includes","isAdmin","isStudentOrAlumni","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","ctx","Error","$RefreshReg$"],"sources":["/Users/macbookair/Desktop/AeroJobs/AeroJob/frontend/src/contexts/AuthContext.js"],"sourcesContent":["// src/contexts/AuthContext.js\r\nimport React, { createContext, useContext, useEffect, useReducer } from 'react';\r\nimport { authAPI, setAuthToken } from '../utils/api';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst AuthContext = createContext();\r\n\r\nconst ACTIONS = {\r\n  SET_LOADING: 'SET_LOADING',\r\n  LOGIN_SUCCESS: 'LOGIN_SUCCESS',\r\n  LOGOUT: 'LOGOUT',\r\n  UPDATE_USER: 'UPDATE_USER',\r\n  SET_ERROR: 'SET_ERROR',\r\n};\r\n\r\nconst initial = {\r\n  user: null,\r\n  token: null,\r\n  isAuthenticated: false,\r\n  loading: true,\r\n  error: null,\r\n};\r\n\r\nfunction reducer(state, action) {\r\n  switch (action.type) {\r\n    case ACTIONS.SET_LOADING:\r\n      return { ...state, loading: action.payload };\r\n    case ACTIONS.LOGIN_SUCCESS:\r\n      return {\r\n        ...state,\r\n        user: action.payload.user,\r\n        token: action.payload.token,\r\n        isAuthenticated: true,\r\n        loading: false,\r\n        error: null,\r\n      };\r\n    case ACTIONS.UPDATE_USER:\r\n      return { ...state, user: action.payload };\r\n    case ACTIONS.LOGOUT:\r\n      return { ...initial, loading: false };\r\n    case ACTIONS.SET_ERROR:\r\n      return { ...state, error: action.payload, loading: false };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction normalizeError(err, fallback = 'Something went wrong') {\r\n  if (err?.message) return err.message;\r\n  return fallback;\r\n}\r\n\r\n// role helpers (work with role | userType | type)\r\nconst getRoleFromUser = (u) => (u?.role || u?.userType || u?.type || null);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [state, dispatch] = useReducer(reducer, initial);\r\n\r\n  // Rehydrate token on refresh and fetch /auth/me\r\n  useEffect(() => {\r\n    const t = localStorage.getItem('token');\r\n    if (t) {\r\n      setAuthToken(t);\r\n      authAPI\r\n        .me()\r\n        .then((me) =>\r\n          dispatch({ type: ACTIONS.LOGIN_SUCCESS, payload: { user: me, token: t } })\r\n        )\r\n        .catch(() => {\r\n          localStorage.removeItem('token');\r\n          setAuthToken(null);\r\n          dispatch({ type: ACTIONS.SET_LOADING, payload: false });\r\n        });\r\n    } else {\r\n      dispatch({ type: ACTIONS.SET_LOADING, payload: false });\r\n    }\r\n  }, []);\r\n\r\n  async function login({ email, password }) {\r\n    dispatch({ type: ACTIONS.SET_LOADING, payload: true });\r\n    try {\r\n      const { user, token } = await authAPI.login({ email, password });\r\n      localStorage.setItem('token', token);\r\n      setAuthToken(token);\r\n      dispatch({ type: ACTIONS.LOGIN_SUCCESS, payload: { user, token } });\r\n      toast.success('Logged in!');\r\n      return { success: true, user };\r\n    } catch (err) {\r\n      const msg = normalizeError(err, 'Login failed');\r\n      dispatch({ type: ACTIONS.SET_ERROR, payload: msg });\r\n      toast.error(msg);\r\n      return { success: false, error: msg };\r\n    }\r\n  }\r\n\r\n  function logout(showToast = true) {\r\n    localStorage.removeItem('token');\r\n    setAuthToken(null);\r\n    dispatch({ type: ACTIONS.LOGOUT });\r\n    if (showToast) toast('Logged out');\r\n  }\r\n\r\n  async function refreshMe() {\r\n    try {\r\n      const me = await authAPI.me();\r\n      dispatch({ type: ACTIONS.UPDATE_USER, payload: me });\r\n      return me;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // NEW: safe updater so header re-renders after profile save/photo change\r\n  function updateUser(patchOrFn) {\r\n    const next =\r\n      typeof patchOrFn === 'function'\r\n        ? patchOrFn(state.user)\r\n        : { ...(state.user || {}), ...(patchOrFn || {}) };\r\n    dispatch({ type: ACTIONS.UPDATE_USER, payload: next });\r\n    return next;\r\n  }\r\n\r\n  // role helpers for UI\r\n  const role = getRoleFromUser(state.user);\r\n  const hasRole = (...roles) => roles.includes(role);\r\n  const isAdmin = () => role === 'admin';\r\n  const isStudentOrAlumni = () => role === 'student' || role === 'alumni';\r\n\r\n  const value = {\r\n    ...state,\r\n    login,\r\n    logout,\r\n    refreshMe,\r\n    updateUser, // expose\r\n    role,\r\n    hasRole,\r\n    isAdmin,\r\n    isStudentOrAlumni,\r\n  };\r\n\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n}\r\n\r\nexport function useAuth() {\r\n  const ctx = useContext(AuthContext);\r\n  if (!ctx) throw new Error('useAuth must be used within an AuthProvider');\r\n  return ctx;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}